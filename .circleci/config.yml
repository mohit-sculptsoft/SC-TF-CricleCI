version: 2.1  
jobs:
  plan-apply:
    docker:
      - image: docker.mirror.hashicorp.services/hashicorp/terraform:light

    environment:
      AWS_ACCESS_KEY_ID: "ASIAR2M5WYU37OTVQNRW"
      AWS_SECRET_ACCESS_KEY: "YSbRyRP9NTPvGfJO/GSglcynkkeQSFml3XA/JE/r"
      AWS_SESSION_TOKEN: "IQoJb3JpZ2luX2VjEMb//////////wEaCXVzLWVhc3QtMiJGMEQCIDxXRlQMgcT+xMLOyAhH2wwiDTrNbPe9mzxitUg7MhUYAiBRFSDjm7mHmAnttr7gFtVpjbLBSBKitfzbGepWH75+NCqgAwjP//////////8BEAAaDDEyNTQyMTY2NzYzOSIMpUy0c90wqSPCQ7W/KvQCilSioc0g4WeHQjbSlfVOLkEL6hXAEMgNfJBKEUE9Ai7VU/tQQtGvHaYHfwKCdRYT3oWPzuqi3DOUikB3M2xQk6kGZRzLkPmD4U7h8Ifx7DflnAR8cdVLMgYFw8sKmXQ/g8eLsQkJO8qTq4dGXpdLoVDczMewrDeHyBnqOdq9FUntkkKU53OaXZW/XQ9KJLrjK3ZVa7yAx/lpgLr4kaircEj5Kb8Z2jFy3Cxo9VLb5/AQmbE5NgbsVAZ1m/B7rS3cxRShODNKaANHgNG9SRnjRMXmr2pAqEDs+IXGOYEoAZyI8nmxKEAUqgt3LGjmHAJKxhlTJe/V2fytDccgK10RB/FaPxp7H+UJC6YTQm0BB4mpf6FyyGog1Wf9U4/au11wJk9uTH/BwR+U+lh0EoPMFEKSUQphF+IEmgn4LAJwdGNsl6a2KD0S41UPNN5hbEBLpO5M4HXnr748sD+OX7pdSRVaS5PmHiSkBTBh//rjHm008ptjMKLsx6IGOqcBNAXBr22OQJtEC79osQV2zZGMTvgn6Dawg+TtnRBdnZELhb9wG3uZS+5FnKdu8zIFeIe11HPgpYpySL3XFtjUqwqx4LqHI1KWSh+vyAocE78G6sKGWZci/spoCKCu08K6f23ElxBaGCsHo1X4MdTxUt48DwlvFSe9KPnVtLeguvotF1+vEVU2kgUARf74w7BZFlCXYUp1nZxkHToVort4Rrxiy1n51+s="

    steps:
      - checkout
      - run: terraform init
      - run: terraform validate -no-color
      - run: terraform plan -no-color -input=false
      - run: terraform apply -auto-approve -input=false

workflows:
  version: 2
  plan_approve_apply:
    jobs:
      - plan-apply